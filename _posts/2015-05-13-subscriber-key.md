---
layout: page
title: "Subscriber Key"
subtitle: "Updating Subscriber Key"
category: features
date: 2015-05-14 12:00:00
order: 1
---
Prior to release 4.0.0, the SDK would set a default subscriber key to a unique hash called DeviceId.  Because this can cause duplicate records for companies who import contacts, we have stopped setting a default subscriber key in the SDK.

If you would like to continue to set a default subscriber key to the DeviceId generated by the SDK, then follow these directions.  

> Please be aware of the implications of this approach if you also import contact records into your Marketing Cloud account.

When a registration is sent to the MarketingCloud, an event is added to the EventBus when the registration is sent.  You can add a callback event in your Application class for the RegistrationEvent.  For directions on how to setup a class to receive an event callback, see the [EventBus](eventbus.html) documentation.

~~~
    public class YourApplication extends Application {
    …
    …
        public void onEvent(final RegistrationEvent event) {
            if (TextUtils.isEmpty(event.getSubscriberKey())) {
                ETPush.getInstance().setSubscriberKey(event.getDeviceId());
            }
        }
    …
    …
~~~
You may also want to set the Subsciber Key to a specific value provided by your customer as the unique identifier for the contact. You can use a mobile number, email address, or other appropriate value as necessary.

This example (taken from the <a href="https://github.com/ExactTarget/JB4A-SDK-Android-Beta/tree/beta/JB4A-SDK-Explorer" target="_blank">Journey Builder for Apps SDK Explorer (Beta) for Android</a>) uses a PreferenceActivity to allow your users to enter or change the subscriber key in their Contact record.

The ETPush.getInstance().setSubscriberKey() method will create a new registration record and send it to the Marketing Cloud.  It will take up to 15 minutes for this value to be recorded in the Contact record.  If the internet is not available when the update is made, the SDK will save the update and send whenever the network becomes available.

> By default, if your app does not set the subscriber key using setSubscriberKey(), the registration sent will be matched with a Contact Record that matches the System Token included in the registration payload.  If no match is found, then a new subscriber key will be set in the Marketing Cloud and will not be sent back to the SDK.

~~~ 
public class SettingsActivity extends PreferenceActivity {
    private static final String TAG = "SettingsActivity";
    …
    …
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        addPreferencesFromResource(R.xml.preferences);
    …
    …
       //
        // SUBSCRIBER KEY PREFERENCE
        //
        final Preference skPref = findPreference(CONSTS.KEY_PREF_SUBSCRIBER_KEY);
        if (!sp.getString(CONSTS.KEY_PREF_SUBSCRIBER_KEY, "").isEmpty()) {
            skPref.setSummary(sp.getString(CONSTS.KEY_PREF_SUBSCRIBER_KEY, ""));
        }

        skPref.setOnPreferenceClickListener(new Preference.OnPreferenceClickListener() {

            @Override
            public boolean onPreferenceClick(Preference preference) {

                PreferenceScreen prefSet = getPreferenceScreen();

                final EditTextPreference skETP = (EditTextPreference) prefSet.findPreference(CONSTS.KEY_PREF_SUBSCRIBER_KEY);

                final AlertDialog d = (AlertDialog) skETP.getDialog();
                final EditText skET = skETP.getEditText();
                skET.setText(sp.getString(CONSTS.KEY_PREF_SUBSCRIBER_KEY, ""));

                Button b = d.getButton(AlertDialog.BUTTON_POSITIVE);
                b.setOnClickListener(new View.OnClickListener() {

                    @Override
                    public void onClick(android.view.View v) {
                        String newSubscriberKey = skET.getText().toString().trim();
                        if (newSubscriberKey.isEmpty()) {
                            Utils.flashError(skET, getString(R.string.error_cannot_be_blank));
                            return;
                        } else {

                            // save the preference to Shared Preferences
                            updatePreferencesForKey(CONSTS.KEY_PREF_SUBSCRIBER_KEY, newSubscriberKey);
                            skPref.setSummary(newSubscriberKey);

                            try {
                                ETPush.getInstance().setSubscriberKey(newSubscriberKey);
                            } catch (ETException e) {
                                if (ETPush.getLogLevel() <= Log.ERROR) {
                                    Log.e(TAG, e.getMessage(), e);
                                }
                            }
                        }

                        d.dismiss();
                    }
                });

                return true;
            }
        });
    }
    …
    …
}
~~~ 